<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>POI(二) | NOTES</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="shahow's notes">
    
    <link rel="preload" href="/notes/assets/css/0.styles.aa6162e3.css" as="style"><link rel="preload" href="/notes/assets/js/app.3c87835c.js" as="script"><link rel="preload" href="/notes/assets/js/2.ccd32cf6.js" as="script"><link rel="preload" href="/notes/assets/js/15.a128062c.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.e74b660e.js"><link rel="prefetch" href="/notes/assets/js/11.ba9cc4ad.js"><link rel="prefetch" href="/notes/assets/js/12.56d107ff.js"><link rel="prefetch" href="/notes/assets/js/13.f1d5b157.js"><link rel="prefetch" href="/notes/assets/js/14.5c1e6475.js"><link rel="prefetch" href="/notes/assets/js/16.9f9c7ffc.js"><link rel="prefetch" href="/notes/assets/js/17.1fa8c72c.js"><link rel="prefetch" href="/notes/assets/js/18.fa98ee4f.js"><link rel="prefetch" href="/notes/assets/js/19.139875e6.js"><link rel="prefetch" href="/notes/assets/js/20.d01c81b7.js"><link rel="prefetch" href="/notes/assets/js/21.d14ce60a.js"><link rel="prefetch" href="/notes/assets/js/22.fc527ece.js"><link rel="prefetch" href="/notes/assets/js/23.42bccf3c.js"><link rel="prefetch" href="/notes/assets/js/24.feb7023c.js"><link rel="prefetch" href="/notes/assets/js/25.c40531f5.js"><link rel="prefetch" href="/notes/assets/js/26.0ae20a4b.js"><link rel="prefetch" href="/notes/assets/js/3.c53e1aaa.js"><link rel="prefetch" href="/notes/assets/js/4.a12cf40c.js"><link rel="prefetch" href="/notes/assets/js/5.c6377d92.js"><link rel="prefetch" href="/notes/assets/js/6.f65fa6bc.js"><link rel="prefetch" href="/notes/assets/js/7.708cf71a.js"><link rel="prefetch" href="/notes/assets/js/8.322cd020.js"><link rel="prefetch" href="/notes/assets/js/9.b8529d16.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.aa6162e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><img src="/notes/imgs/logo.jpg" alt="NOTES" class="logo"> <span class="site-name can-hide">NOTES</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/notes/java/" aria-current="page" class="sidebar-link">Java</a></li><li><a href="/notes/java/spring/" class="sidebar-link">Spring</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="poi-二"><a href="#poi-二" class="header-anchor">#</a> POI(二)</h1> <p>Java POI-3.17</p> <h5 id="数据有效性"><a href="#数据有效性" class="header-anchor">#</a> 数据有效性</h5> <p>Excel中单元格的数据有效性验证功能通过<strong>DataValidation</strong>接口支持。HSSFWorkbook和XSSFWorkbook设置数据有效性的API略有差异。</p> <ul><li><p>HSSFWorkbook</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 数据有效性的单元格范围</span>
<span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 数据有效性类型</span>
<span class="token class-name">DVConstraint</span> constraint <span class="token operator">=</span> <span class="token class-name">DVConstraint</span><span class="token punctuation">.</span>create<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">Constraint</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 实例化数据有效性</span>
<span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HSSFDataValidation</span><span class="token punctuation">(</span>regions<span class="token punctuation">,</span> constraint<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>XSSFWorkbook</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 数据有效性的单元格范围</span>
<span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <p>XSSFDataValidationHelper dvHelper = new XSSFDataValidationHelper((XSSFSheet) sheet);
// 数据有效性类型
DataValidationConstraint dvConstraint = dvHelper.create...Constraint(...);
// 实例化数据有效性
DataValidation dataValidation = dvHelper.createValidation(dvConstraint, regions);</p> <div class="language- extra-class"><pre class="language-text"><code>
+ 作用到Sheet

```java
DataValidation dataValidation = ...;// 实例化数据绑定
sheet.addValidationData(dataValidation);
</code></pre></div><h5 id="日期有效性"><a href="#日期有效性" class="header-anchor">#</a> 日期有效性</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* 获取日期数据有效性
* 日期固定在1900-1-1 ~ 2999-12-31
*
* @param fileType
* @param sheet
* @param firstRow
* @param lastRow
* @param firstCow
* @param lastCow
* @return
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataValidation</span> <span class="token function">getDataValidationByDateValidation</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileType<span class="token punctuation">,</span> 															   <span class="token class-name">Sheet</span> sheet<span class="token punctuation">,</span> 																   <span class="token keyword">int</span> firstRow<span class="token punctuation">,</span>
                                                               <span class="token keyword">int</span> lastRow<span class="token punctuation">,</span> 															   	   <span class="token keyword">int</span> firstCow<span class="token punctuation">,</span>
                                                               <span class="token keyword">int</span> lastCow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xls&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置第key列的1-65535行为下拉列表</span>
    <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建下拉列表数据</span>
    <span class="token class-name">DVConstraint</span> constraint <span class="token operator">=</span> <span class="token class-name">DVConstraint</span><span class="token punctuation">.</span><span class="token function">createDateConstraint</span><span class="token punctuation">(</span>
<span class="token class-name">DataValidationConstraint<span class="token punctuation">.</span>OperatorType</span><span class="token punctuation">.</span>BETWEEN<span class="token punctuation">,</span>
<span class="token string">&quot;1900-1-1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2099-12-31&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定</span>
   	dataValidation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HSSFDataValidation</span><span class="token punctuation">(</span>regions<span class="token punctuation">,</span> constraint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">XSSFDataValidationHelper</span> dvHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XSSFDataValidationHelper</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">XSSFSheet</span><span class="token punctuation">)</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">DataValidationConstraint</span> dvConstraint <span class="token operator">=</span> dvHelper<span class="token punctuation">.</span><span class="token function">createDateConstraint</span><span class="token punctuation">(</span>
<span class="token class-name">DataValidationConstraint<span class="token punctuation">.</span>OperatorType</span><span class="token punctuation">.</span>BETWEEN<span class="token punctuation">,</span> <span class="token string">&quot;Date(1900, 1, 1)&quot;</span><span class="token punctuation">,</span> 
<span class="token string">&quot;Date(2099, 12, 31)&quot;</span><span class="token punctuation">,</span> DEFAULT_DATE_FORMAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> 	firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
   dataValidation <span class="token operator">=</span> dvHelper<span class="token punctuation">.</span><span class="token function">createValidation</span><span class="token punctuation">(</span>dvConstraint<span class="token punctuation">,</span> regions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
   <span class="token punctuation">}</span>
    
   <span class="token keyword">return</span> dataValidation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="时间有效性"><a href="#时间有效性" class="header-anchor">#</a> 时间有效性</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* 获取时间数据有效性
* 日期固定在00:00:00 ~ 23:59:59
*
* @param fileType
* @param sheet
* @param firstRow
* @param lastRow
* @param firstCow
* @param lastCow
* @return
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataValidation</span> <span class="token function">getDataValidationByDateValidation</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileType<span class="token punctuation">,</span> 															   <span class="token class-name">Sheet</span> sheet<span class="token punctuation">,</span> 																   <span class="token keyword">int</span> firstRow<span class="token punctuation">,</span>
                                                               <span class="token keyword">int</span> lastRow<span class="token punctuation">,</span> 															   	   <span class="token keyword">int</span> firstCow<span class="token punctuation">,</span>
                                                               <span class="token keyword">int</span> lastCow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xls&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置第key列的1-65535行为下拉列表</span>
    <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建下拉列表数据</span>
    <span class="token class-name">DVConstraint</span> constraint <span class="token operator">=</span> <span class="token class-name">DVConstraint</span>
        <span class="token punctuation">.</span><span class="token function">createTimeConstraint</span><span class="token punctuation">(</span><span class="token class-name">DataValidationConstraint<span class="token punctuation">.</span>OperatorType</span><span class="token punctuation">.</span>BETWEEN<span class="token punctuation">,</span>
                    <span class="token string">&quot;00:00:00&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;23:59:59&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定</span>
   	dataValidation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HSSFDataValidation</span><span class="token punctuation">(</span>regions<span class="token punctuation">,</span> constraint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">XSSFDataValidationHelper</span> dvHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XSSFDataValidationHelper</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">XSSFSheet</span><span class="token punctuation">)</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">DataValidationConstraint</span> dvConstraint <span class="token operator">=</span> dvHelper           <span class="token punctuation">.</span><span class="token function">createTimeConstraint</span><span class="token punctuation">(</span><span class="token class-name">DataValidationConstraint<span class="token punctuation">.</span>OperatorType</span><span class="token punctuation">.</span>BETWEEN<span class="token punctuation">,</span> <span class="token string">&quot;00:00:00&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;23:59:59&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
   dataValidation <span class="token operator">=</span> dvHelper<span class="token punctuation">.</span><span class="token function">createValidation</span><span class="token punctuation">(</span>dvConstraint<span class="token punctuation">,</span> regions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
   <span class="token punctuation">}</span>
    
   <span class="token keyword">return</span> dataValidation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="序列有效性-下拉框"><a href="#序列有效性-下拉框" class="header-anchor">#</a> 序列有效性(下拉框)</h5> <p>序列数据有效性生成后会已下拉框的形式进行展示，不足是POI只能支持单选下拉框。多选下拉框功能查阅资料，需要借助vbs脚本进行实现(T_T)。</p> <ul><li><p>ExplicitList</p> <p>如果已经有明确的下拉序列就可以使用这种<strong>ExplicitListConstraint</strong>数据有效性。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* 获取下拉样式
*
* @param fileType
* @param sheet
* @param firstRow
* @param lastRow
* @param firstCow
* @param lastCow
* @param explicitList
* @return
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataValidation</span> <span class="token function">getDataValidation</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileType<span class="token punctuation">,</span> 															 <span class="token class-name">Sheet</span> sheet<span class="token punctuation">,</span> 																 <span class="token keyword">int</span> firstRow<span class="token punctuation">,</span>
                                               <span class="token keyword">int</span> lastRow<span class="token punctuation">,</span> 															   	 <span class="token keyword">int</span> firstCow<span class="token punctuation">,</span>
                                               <span class="token keyword">int</span> lastCow<span class="token punctuation">,</span>
                                               <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> explicitList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xls&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DVConstraint</span> constraint <span class="token operator">=</span> <span class="token class-name">DVConstraint</span><span class="token punctuation">.</span>
                <span class="token function">createExplicitListConstraint</span><span class="token punctuation">(</span>explicitList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataValidation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HSSFDataValidation</span><span class="token punctuation">(</span>regions<span class="token punctuation">,</span> constraint<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">XSSFDataValidationHelper</span> dvHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XSSFDataValidationHelper</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">XSSFSheet</span><span class="token punctuation">)</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DataValidationConstraint</span> dvConstraint <span class="token operator">=</span> dvHelper
                    <span class="token punctuation">.</span><span class="token function">createExplicitListConstraint</span><span class="token punctuation">(</span>explicitList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CellRangeAddressList</span> addressList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataValidation <span class="token operator">=</span> dvHelper<span class="token punctuation">.</span><span class="token function">createValidation</span><span class="token punctuation">(</span>dvConstraint<span class="token punctuation">,</span> addressList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> dataValidation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>FormulaList</p> <p>FormulaList是基于公式进行序列生成，比ExplicitList更加强大。联级下拉框的实现是通过该方法进行实现。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataValidation</span> <span class="token function">getDataValidation</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileType<span class="token punctuation">,</span>
                                               <span class="token class-name">Sheet</span> sheet<span class="token punctuation">,</span>
                                               <span class="token keyword">int</span> firstRow<span class="token punctuation">,</span>
                                               <span class="token keyword">int</span> lastRow<span class="token punctuation">,</span>
                                               <span class="token keyword">int</span> firstCow<span class="token punctuation">,</span>
                                               <span class="token keyword">int</span> lastCow<span class="token punctuation">,</span>
                                               <span class="token class-name">String</span> formulaList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xls&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DVConstraint</span> constraint <span class="token operator">=</span> <span class="token class-name">DVConstraint</span><span class="token punctuation">.</span><span class="token function">createFormulaListConstraint</span><span class="token punctuation">(</span>formulaList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataValidation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HSSFDataValidation</span><span class="token punctuation">(</span>regions<span class="token punctuation">,</span> constraint<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">XSSFDataValidationHelper</span> dvHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XSSFDataValidationHelper</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">XSSFSheet</span><span class="token punctuation">)</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">XSSFDataValidationConstraint</span> dvConstraint <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">XSSFDataValidationConstraint</span><span class="token punctuation">)</span> dvHelper
                    <span class="token punctuation">.</span><span class="token function">createFormulaListConstraint</span><span class="token punctuation">(</span>formulaList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CellRangeAddressList</span> regions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellRangeAddressList</span><span class="token punctuation">(</span>firstRow<span class="token punctuation">,</span> lastRow<span class="token punctuation">,</span> firstCow<span class="token punctuation">,</span> lastCow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataValidation <span class="token operator">=</span> dvHelper<span class="token punctuation">.</span><span class="token function">createValidation</span><span class="token punctuation">(</span>dvConstraint<span class="token punctuation">,</span> regions<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    
        <span class="token keyword">return</span> dataValidation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>formulaList参数示例:</p> <p>'sheet1'!$A2:$A20 ：选择sheet名为sheet1的A列第2行至第20行，绑定后下拉框相应展示这些内容。</p></li></ul> <h5 id="其他有效性"><a href="#其他有效性" class="header-anchor">#</a> 其他有效性</h5> <p>其他有效性API也是类似上面的，只要按要求放入参数即可。</p> <h5 id="数据有效性的辅助功能"><a href="#数据有效性的辅助功能" class="header-anchor">#</a> 数据有效性的辅助功能</h5> <ul><li><p>允许单元格为空</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
dataValidation<span class="token punctuation">.</span><span class="token function">setEmptyCellAllowed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>提供下拉箭头</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
dataValidation<span class="token punctuation">.</span><span class="token function">setSuppressDropDownArrow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>输入提示</p> <p>让绑定了数据有效性的单元格支持输入提示。该功能也属于<strong>DataValidation</strong>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
dataValidation<span class="token punctuation">.</span><span class="token function">setShowPromptBox</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataValidation<span class="token punctuation">.</span><span class="token function">createPromptBox</span><span class="token punctuation">(</span>TITLE<span class="token punctuation">,</span> CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//标题-TITLE，内容-CONTENT</span>
</code></pre></div></li> <li><p>错误提示</p> <ul><li><p>不对错误数据进行验证</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
dataValidation1<span class="token punctuation">.</span><span class="token function">setShowErrorBox</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>对错误进行验证并提示</p> <p>错误提示有三种错误样式：停止、警告、信息。在停止样式下，错误数据将无法录入单元格。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataValidation</span> dataValidation <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
dataValidation1<span class="token punctuation">.</span><span class="token function">setShowErrorBox</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataValidation<span class="token punctuation">.</span><span class="token function">setErrorStyle</span><span class="token punctuation">(</span><span class="token class-name">DataValidation<span class="token punctuation">.</span>ErrorStyle</span><span class="token punctuation">.</span>STOP<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//错误样式</span>
dataValidation<span class="token punctuation">.</span><span class="token function">createErrorBox</span><span class="token punctuation">(</span>TITLE<span class="token punctuation">,</span> CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//标题-TITLE，内容-CONTENT</span>
</code></pre></div></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.3c87835c.js" defer></script><script src="/notes/assets/js/2.ccd32cf6.js" defer></script><script src="/notes/assets/js/15.a128062c.js" defer></script>
  </body>
</html>
